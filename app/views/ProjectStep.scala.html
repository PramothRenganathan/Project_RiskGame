@*(hm: Map[models.Phase, List[models.ProjectStep]])*@
@(model: models.InitialGameStat)
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Project Steps</title>
        <link rel="shortcut icon" href="">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" hredef="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/demo.css")" />
        <link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/style.css")" />
        <link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/animate-custom.css")" />

        <link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/flipclock.css")" />

        <script src="@routes.Assets.at("javascripts/flipclock.js")"></script>

        <script type="text/javascript" charset="utf-8" src="@routes.Application.gameJs()"></script>

        <style type="text/css">
        .container > header {
            padding: 0px 30px 10px 30px !important;

        }

        td {
            padding-right: 20px;
            padding-bottom: 20px;
        }

        .ProjectStepStyle{
            background: #F25827;
            border-color:#F05C2B;
        }



        .ProjectStepStyle:hover,
        .ProjectStepStyle:focus,
        .ProjectStepStyle:active,
        .ProjectStepStyle.active,
        .ProjectStepStyle.disabled,
        .ProjectStepStyle[disabled] {
            background: #F53C00 !important;
            border-color:#F53C00 !important;
        }
        .ProjectStepStyle:active,
        .ProjectStepStyle.active {
            background: #F53C00 !important;
            border-color:#F53C00 !important;
        }

        .stepStyle{
            /* BUTTON STYLING */
            border-top: 1px solid #fff;
            box-shadow: 0 5px 8px #002851, 0 8px 0 #002851, -2px 1px 0 #003872, 2px 1px 0 #003872, 0px 8px 10px #000, 0 10px 30px #1b1b1b;
            /*background: red;*/
            /* FONT STYLING */

            text-decoration: none;
            color: #14467a;
            font-weight: bold;
        }
        .stepStyle:hover{
            /* BUTTON SHADOW */
            box-shadow: 0 6px 6px #002851, 0 6px 0 #002851, -1px 0px 0 #003872, 0px 0px 0 #003872, 0px 7px 8px #000, 0 7px 20px #1b1b1b;
        }
        /* BLUE GRADIENT ON BUTTON */
        .grad {
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(114,184,255,1)), color-stop(100%,rgba(64,150,238,1)));
            background: linear-gradient(to bottom, rgba(114,184,255,1) 0%,rgba(64,150,238,1) 100%);
        }

        /* ANIMATE THE BUTTON */
        .transition,
        .transition:hover,
        {
            -webkit-transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
            transition: all 0.3s ease-in-out;
        }

        .highlight {
            position: relative;
            margin: -200px auto 0 auto;
            width: 500px;
            height: 400px;
            opacity: 0.4;
            background: -moz-radial-gradient(top, ellipse cover, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%);
            background: -webkit-gradient(radial, top top, 0px, center center, 100%, color-stop(0%,rgba(255,255,255,1)), color-stop(100%,rgba(255,255,255,0)));
            background: -webkit-radial-gradient(top, ellipse cover, rgba(255,255,255,0.3) 0px,rgba(255,255,255,0) 275px);
        }
        .phaseStyle{
            /* BUTTON STYLING */
            border-top: 1px solid #fff;
            box-shadow: 0 5px 8px #EDBF5C, 0 8px 0 #EDBF5C, -2px 1px 0 #EDBF5C, 2px 1px 0 #EDBF5C, 0px 8px 10px #000, 0 10px 30px #EDBF5C;

            /* FONT STYLING */

            text-decoration: none;
            color: #14467a;
            font-weight: bold;
        }

        .phaseStyle:hover{
            /* BUTTON SHADOW */
            color: #ffffff;
            box-shadow: 0 6px 6px #EDBF5C, 0 6px 0 #EDBF5C, -1px 0px 0 #EDBF5C, 0px 0px 0 #EDBF5C, 0px 7px 8px #000, 0 7px 20px #EDBF5C;
        }
        .modalHeader{
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(114,184,255,1)), color-stop(100%,rgba(64,150,238,1)));
            background: linear-gradient(to bottom, rgba(114,184,255,1) 0%,rgba(64,150,238,1) 100%);
        }
        </style>


    </head>
    <script>


            function myfunc(clicked_id) {


                alert("aaaaaaaa" + clicked_id);
            }

            function onPerformStep(id){
//                var isEligibleToPerformStep=true;
//                alert(document.getElementById('turnNo').innerHTML);

                var obj = {
                    'id': id,
                    'gameid':document.getElementById('gameid').innerHTML,
                    'skipturn':'false',
                    'oneturn':0,
                    'twoturn':0,
                    'type': 'projectstep',
                    'budget': document.getElementById('budgetremaining').innerHTML,
                    'capabilitybonus': document.getElementById('capabilitybonus').innerHTML,
                    'capabilitypoints': document.getElementById('capabilitypoints').innerHTML,
                    'personnel' :document.getElementById('personnelremaining').innerHTML,
                    'turnno': document.getElementById('turnNo').innerHTML,
                    'timetaken': 3
                };
                $.ajax({
                    type: 'POST',
                    url: '@routes.GameController.performStep()',
                    // data : JSON.stringify(obj),
                    data: JSON.stringify(obj),
                    // dataType: 'json',
                    contentType: 'application/json',
                    success: function (data) {
                        document.getElementById('budgetremaining').innerHTML = data.budget;
                        document.getElementById('capabilitypoints').innerHTML = data.capabilitypoints;
                        document.getElementById('capabilitybonus').innerHTML = data.capabilitybonus;
                        document.getElementById('personnelremaining').innerHTML = data.personnel;
                        document.getElementById('turnNo').innerHTML = data.currentturn;

                        onPhaseClick(currentPhase);
                    },
                    error: function (data) {
                        alert("error");
                        //setError('Make call failed');
                    }
                });

            }

            var currentPhase="";

            function onPhaseClick(clicked_id) {

                currentPhase=clicked_id;
                var test = 'abc';
//                    var test = $.('#id').val();
//                    alert(clicked_id);
                var obj = {
                    'phaseId': clicked_id
                };
                $.ajax({
                    type: 'POST',
                    url: '@routes.GameController.getProjectSteps()',
                    // data : JSON.stringify(obj),
                    data: JSON.stringify(obj),
                    // dataType: 'json',
                    contentType: 'application/json',
                    success: function (data) {
//                            alert(Object.prototype.toString.call(data));
//                        alert('im here');
                        var result = "";
                        for (i = 0; i < data.length; i++) {
                            var obj = data[i];

//                                alert(obj.status);
                            var status;
                            if(obj.status){
                                obj.status="disabled"
                            }
//                                result= result+"<h1>"+obj.projectStepName+"</h1>";



                            var eligibleBudget=0;
                            var eligibleCapabilityBonus=0;
                            var eligibleCapabilityPoints=0;
                            var eligiblePersonnelRemaining=0;
////                            alert('hereee');
                            eligibleBudget= parseInt(document.getElementById('budgetremaining').innerHTML) - obj.budget;
                            eligibleCapabilityBonus= parseInt(document.getElementById('capabilitybonus').innerHTML) + obj.capabilityBonus;
                            eligibleCapabilityPoints= parseInt(document.getElementById('capabilitypoints').innerHTML) + obj.capabilityPoints;
                            eligiblePersonnelRemaining= parseInt(document.getElementById('personnelremaining').innerHTML) - obj.personnel;

////
                            var setClassColor;
                            var buttonDisable;
                            if(eligibleBudget<0 || eligiblePersonnelRemaining<0){
                                setClassColor="ProjectStepStyle";
                                buttonDisable="true";
//                                alert("you cannot perform this step "+obj.projectStepName );
                            }else{
                                setClassColor=" ";
                                buttonDisable="false"
                            }
//                              alert(document.getElementById('budgetremaining').innerHTML);
//                            alert("elig"+setColor);

//                            alert(eligibleBudget+" "+eligibleCapabilityBonus+" "+eligibleCapabilityPoints+" "+eligiblePersonnelRemaining);








                            result = result + "<button " +obj.status+
                                    " href='#editTodoDialog'  id='" + obj.projectStepId + "'" +
                                    " style='white-space: normal; ' " +
                                    " class='open-EditTodo col-md-3 btn btn-success "+setClassColor+"'" +
                                    " data-toggle='modal'" +
                                    " data-buttondisable='"+buttonDisable+"'" +
                                    "data-title='" + obj.projectStepName +
                                    "'data-id='" + obj.projectStepId +
                                    "'data-budget='Budget:' data-budgetvalue='" + obj.budget +
                                    "'data-capabilitypoints='Capability Points:' data-capabilitypointsvalue='" + obj.capabilityPoints +
                                    "'data-personnel='Personnel:' data-personnelvalue='" + obj.personnel +
                                    "'data-capabilitybonus='Capability Bonus:' data-capabilitybonusvalue='" + obj.capabilityBonus +
                                    "'data-level='Level:' data-levelvalue='" + obj.level +
                                    "'data-id='" + obj.projectStepId +
                                    "'" +
//                                            "data-todo='{'id':12,'todo':'xyz'}'"+
                                    "title='Budget :" + obj.budget + "  Level: " + obj.level +"  Personnel: " + obj.personnel + "'" +
                                    "  id='todolink'>" + obj.projectStepName +
                                    "</button><div class='col-md-1' style='height:90px;'></div>";
//                                    "</button><div class='col-md-1' style='height:90px;"+setColor+"'"></div>";





                        }

//                            alert(result);
                        document.getElementById('results').innerHTML = result;

                    },
                    error: function (data) {
                        alert("error");
                        //setError('Make call failed');
                    }
                });

            }

            $(document).on("click", ".open-EditTodo", function () {
//                alert($(this).data('title'));

                var title = $(this).data('title');
                var budget = $(this).data('budget');
                var budgetValue = $(this).data('budgetvalue');
                var capabilityPoints = $(this).data('capabilitypoints');
                var capabilityPointsValue = $(this).data('capabilitypointsvalue');
                var capabilityBonus = $(this).data('capabilitybonus');
                var capabilityBonusValue = $(this).data('capabilitybonusvalue');
                var buttonDisabled= $(this).data('buttondisable');
                var level = $(this).data('level');
                var levelValue = $(this).data('levelvalue');
                var personnel = $(this).data('personnel');
                var personnelValue = $(this).data('personnelvalue');
//                alert(buttonDisabled);
                if(buttonDisabled===true){
                    document.getElementById("isDisabled").innerHTML="Oops! You don't have enough resources!";
                }
                var projectStepId = $(this).data('id');
                $(".perform-step").attr("id",projectStepId);
                $(".perform-step").attr("disabled",buttonDisabled);
                $("#windowtitle").text(title);
                $("#Budget").text(budget);
                $("#BudgetValue").text(budgetValue);
                $("#CapabilityPoints").text(capabilityPoints);
                $("#CapabilityPointsValue").text(capabilityPointsValue);
                $("#CapabilityBonus").text(capabilityBonus);
                $("#CapabilityBonusValue").text(capabilityBonusValue);
                $("#Level").text(level);
                $("#LevelValue").text(levelValue);
                $("#Personnel").text(personnel);
                $("#PersonnelValue").text(personnelValue);
                $("#ProjectStepId").val(projectStepId);
//                alert("<button id='"+projectStepId+"' class='btn btn-success perform-step'  style='margin-bottom: 20px' onclick='onPerformStep("+"\""+projectStepId+"\""+")' >Perform this Step</button>");
//


            });

            function totalGameTimer() {

                var sec = 0;

                function pad(val) {
                    return val > 9 ? val : "0" + val;
                }

                var timer = setInterval(function () {
                    document.getElementById("seconds").innerHTML = pad(++sec % 60);
                    document.getElementById("minutes").innerHTML = pad(parseInt(sec / 60, 10));
                }, 1000);

                setTimeout(function () {
                    clearInterval(timer);
                }, 500000);
            }
    </script>
    <body style="background-image: url(@routes.Assets.at("images/bg.jpg"));" onload="onPhaseClick('CPM1');
    totalGameTimer()">
        <input type="hidden" name="phase" id="phase" value="plan"/>
        <input type="hidden" name="username" id="username" value='@model.getUserName()'/>
        <input type="hidden" name="gameid" id="gameid" value='@model.getGameId()'/>
        <input type="hidden" name="turn" id="turn" value='@model.getTurnNo()'/>
        <div class="container" >

            <header style="" >

                <div class="col-md-4" style="background-color: #CED4BD">RISK-GAME-- LOGONEW</div>
                @*<div class="col-md-2 " ></div>*@
                <div class="col-md-3" style="background-color: #CED4BD" id="gameid">Game ID: @model.getGameId()</div>
                <div class="col-md-3" style="background-color: #CED4BD">
                    Total Game time
                    <span id="minutes">00</span>:<span id="seconds">00</span>
                </div>
                <div class="col-md-2" style="display: inline-block;">
                        <!-- Single button --><div style=" display: inline-block;" class="glyphicon glyphicon-user">Welcome @model.getUserName().split("@")(0)!</div>
                    <div style=" display: inline-block;" class="btn-group">
                        <button type="button"
                        class=" dropdown-toggle glyphicon glyphicon-cog" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">

                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#">Help</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">Leave Game</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="/logout" >Logout</a></li>
                        </ul>
                    </div>
                </div>
            </header>


            <div class="col-xs-12" style="height: 30px;"></div>
            @*<header>*@
            @*<div class="col-md-12" style="background-color: #E09D87" >*@
            @*<div class="col-md-2" style="border: 1px solid transparent">Time Remaining: 4:00</div>*@
            @*<div class="col-md-3" style="border: 1px solid transparent">Budget Left: 50000</div>*@
            @*<div class="col-md-3" style="border: 1px solid transparent">Capability Points : 15</div>*@
            @*<div class="col-md-2" style="border: 1px solid transparent">Capability Bonus : 30%</div>*@

            @*<div class="col-md-2" style="border: 1px solid transparent">*@
            @*<button class="btn btn-info" >Help</button>*@
            @*<button class="btn btn-danger" > Exit Game</button>*@

            @*</div>*@
            @*</div>*@
            @*</header>*@
            <header>
                <div class="col-md-2" style="border-right: 1px dashed #969C9E">


                    <div class="panel panel-default">
                        <div class="panel-heading" style="background-color: #A8A2A3">
                            <h4 class="panel-title">My Status</h4>
                        </div>
                        <div class="panel-body" style="height: 100px; overflow-wrap: break-word;overflow-y: scroll;font-size:small;">
                            <div style=" display: inline-block;">Budget:</div><div style=" display: inline-block;" id="budgetremaining"> @model.getBudget()</div>
                            <div style=" display: inline-block;">Capability Points:</div><div style=" display: inline-block;" id="capabilitypoints"> @model.getCapabilityPoints()</div>
                            <div style=" display: inline-block;">Capability Bonus:</div><div style=" display: inline-block;" id="capabilitybonus"> @model.getCapabilityBonus()</div>
                            <div style=" display: inline-block;">Personnel:</div><div style=" display: inline-block;" id="personnelremaining"> @model.getResources</div>
                            @*<a data-toggle="modal" data-target="#myAssetModal" style="color: blue">More info >></a>*@


                        </div>
                        <div class="modal fade" id="myAssetModal" role="dialog">
                            <div class="modal-dialog">

                                    <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">Status</h4>
                                    </div>
                                    <div class="modal-body" style="text-align: left">
                                        <div>Budget Remaining: @model.getBudget()</div>
                                        <div>Capability Points: @model.getCapabilityPoints()</div>
                                        <div>Capability Bonus: @model.getCapabilityBonus()</div>
                                        <div>Risks Mitigated</div>

                                        <div style="height: 30px;"></div>
                                        <div style="font-weight: bolder;
                                            font-size: large" >
                                            <h2>Project Steps Completed</h2>
                                        </div>
                                        <div>Planning: 2/ 10</div>
                                        <div>Requirements: 2/9</div>
                                        <div>Design: </div>
                                        <div>Implementation</div>
                                        <div>Testing</div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" style="background-color: #A8A2A3">
                            <h4 class="panel-title">Current Action</h4>
                        </div>
                        <div class="panel-body" style="height: 200px; ">
                            <div style=" display: inline-block;">Turn No: </div><div style=" display: inline-block;" id="turnNo">1</div>

                            <div class="col-md-3 mytimer" style="zoom: 0.4;padding:0" hidden>

                            </div>
                        </div>

                    </div>


                    <div class="panel panel-default">
                        <div class="panel-heading" style="background-color: #A8A2A3">
                            <h4 class="panel-title">Who's turn? </h4>
                        </div>
                        <div id="activePlayersList" class="panel-body" style="height: 60px;">
                            user1<br/>
                            user2<br/>
                        </div>
                    </div>
                    @*<div style="height: 300px;*@
                    @*border: 1px solid transparent;*@
                    @*background-size: 100% 100%;*@
                    @*background-image: url(@routes.Assets.at("images/chat1.jpg")) !important;"></div>*@


                </div>
                <div class="col-md-8" style="border: 1px solid transparent">

                    @*<div class="col-md-12">*@
                    @*<div class="col-md-4" style="border: 1px solid black">Budget left</div>*@
                    @*<div class="col-md-4" style="border: 1px solid black">Capability points</div>*@
                    @*<div class="col-md-4" style="border: 1px solid black">Time Remaining</div>*@
                    @*<div class="col-md-4" style="border: 1px solid black">60000</div>*@
                    @*<div class="col-md-4" style="border: 1px solid black">5%</div>*@
                    @*<div class="col-md-4" style="border: 1px solid black">3:30</div>*@
                    @*</div>*@
                    <div class="col-md-12" style="border: 1px solid transparent">
                        <div style="height: 20px; "></div>
                        @for(phase <- model.getPhases()) {

                            <button class="col-md-3 btn btn-warning"
                            style="background-color: #DB8B00 !important;"
                            onclick="onPhaseClick(id)"
                            id=@phase.getPhaseId>@phase.getPhaseName()</button>
                            <div class="col-md-1" style="height: 60px;"> </div>

                        }

                    </div>

                    <div class="col-md-12" style="border: 1px solid transparent;
                        height: 400px">
                        <hr style="width: 100%;
                            color: black;
                            height: 1px;
                            background-color: black;" />
                        <div class="col-md-12" style="height: 50px;"> </div>
                        <div id="results"></div>
                    </div>


                </div>
                <div class="col-md-2" style="border-left: 1px Dashed #969C9E;
                    border-width: thin">

                    <div class="panel panel-default">
                        <div class="panel-heading" style="background-color: #A8A2A3">
                            <h4 class="panel-title">Chat</h4>
                        </div>
                        <div id="chatArea" class="panel-body" style="height: 200px;
                            border: 1px solid transparent;
                            background-size: 100% 100%; overflow-wrap: break-word;overflow-y: scroll;">
                        </div>

                    </div>

                    <textarea id="txtMessage">

                    </textarea>
                    <div>
                        <input id="btnSend" style="width: inherit;" type="button" value="send"/>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading" style="background-color: #A8A2A3">
                            <h4 class="panel-title">Activity Log </h4>
                        </div>
                        <div class="panel-body" style="height: 300px; overflow-wrap: break-word;overflow-y: scroll" id="activity-log">

                        </div>
                    </div>
                </div>

            </header>
            <div class="clearfix"></div>
            <div class="clearfix"></div>
            <div class="clearfix"></div>
            <header>

            </header>


            <div class="modal fade" tabindex="-1" role="dialog" style="margin-top: 150px;" id="editTodoDialog">
                <div class="modal-dialog" align="center">
                    <div class="modal-content" style="width: 350px;">
                        <div class="modal-header modalHeader" align="left" >
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">
                                Close</span></button>
                            <h4 id="windowtitle" class="modal-title" >new window</h4>


                        </div>
                        <div class="modal-body" align="center" style="display: inline">

                            <table>
                                <tr>
                                    <td><h5 id="Budget" > </h5></td>
                                    <td><h5 id="BudgetValue"></h5></td>
                                </tr>
                                <tr>
                                    <td><h5 id="CapabilityPoints" > </h5></td>
                                    <td><h5 id="CapabilityPointsValue"></h5></td>
                                </tr>
                                <tr>
                                    <td><h5 id="CapabilityBonus" > </h5></td>
                                    <td><h5 id="CapabilityBonusValue"></h5></td>
                                </tr>
                                <tr>
                                    <td><h5 id="Level" > </h5></td>
                                    <td><h5 id="LevelValue"></h5></td>
                                </tr>
                                <tr>
                                    <td><h5 id="Personnel" > </h5></td>
                                    <td> <h5 id="PersonnelValue"></h5></td>
                                </tr>

                            </table>

                            <input type="hidden" id="ProjectStepId" value="">

                            <div class="col-xs-12" style="height: 30px;"></div>
                            <div id="performstep"></div>
                            <button disabled=""  id="" class="btn btn-success perform-step"  style="margin-bottom: 20px" onclick="onPerformStep(id)" >Perform this Step</button>
                            <div id="isDisabled" style="color: #8b0000;"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </body>
</html>